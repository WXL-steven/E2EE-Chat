# 前端架构设计

## 1. 技术栈
- JSP + AJAX
- WebCrypto API
- Bootstrap 5

## 2. 页面结构

### 2.1 公共组件
- 导航栏组件
- 加载提示组件
- 错误提示组件
- 确认对话框组件

### 2.2 用户认证页面
- 登录页面（login.jsp）
  * 用户名/密码输入
  * 记住登录功能
  * PIN码解锁功能
- 注册页面（register.jsp）
  * 用户信息输入
  * 密码强度检查
  * PIN码设置

### 2.3 主聊天界面（chat.jsp）
- 会话列表面板
  * 会话预览
  * 未读消息计数
  * 最后消息时间
- 聊天窗口
  * 消息列表
  * 输入框
  * Markdown格式工具栏
- 用户信息面板
  * 用户基本信息
  * 在线状态
  * 设置选项

## 3. JavaScript模块

### 3.1 加密模块（crypto.js）
- 密钥对生成
- 消息加解密
- 密钥管理

### 3.2 会话管理模块（session.js）
- 会话列表维护
- 未读消息计数
- 会话状态管理

### 3.3 消息处理模块（message.js）
- 消息发送队列
- 消息接收处理
- Markdown渲染

### 3.4 用户界面模块（ui.js）
- 动态界面更新
- 消息动画效果
- 响应式布局处理

## 4. 统一样式系统

我们使用 Tailwind CSS 构建了一套统一的样式系统，以确保整个应用的视觉一致性和可维护性。

### 开发流程

1. 开发环境
   - 源码位于 `src/main/webapp/assets/css/dev/`
   - 使用 `styles.css` 定义所有组件样式
   - 通过 `@apply` 指令组合 Tailwind 的原子类

2. 生产环境
   - 编译后的文件位于 `src/main/webapp/assets/css/dist/`
   - 使用 `bunx tailwindcss` 命令进行编译
   - 编译过程会移除未使用的样式，优化文件大小

### 组件设计

1. 布局组件
   - 主容器：固定高度，内部滚动
   - 弹性布局：大量使用 Flexbox 实现灵活的布局

2. 交互组件
   - 按钮：主要、次要、警告和图标按钮
   - 输入框：文本、密码、PIN码和多行文本
   - 下拉菜单：自适应内容宽度，最大200px

3. 消息组件
   - 消息泡：发送和接收两种样式，最大宽度400px
   - 日期分隔：居中显示的半透明泡泡
   - 文本格式化：等宽、粗体、斜体、下划线和删除线

4. 辅助组件
   - 头像：圆形背景配单字符
   - 提示条：成功、警告和错误三种状态
   - 时间显示：嵌入式时间戳

### 设计原则

1. 一致性
   - 统一的颜色系统
   - 一致的间距和圆角
   - 规范的阴影效果

2. 可复用性
   - 组件样式模块化
   - 使用 CSS 类组合而非继承
   - 避免上下文依赖

3. 响应式
   - 弹性布局优先
   - 合理的最大/最小尺寸
   - 内容自适应

4. 可维护性
   - 清晰的类名命名
   - 模块化的样式组织
   - 详细的注释说明

### 性能优化

1. 开发优化
   - 使用 Tailwind 的 JIT 编译
   - 组件样式按功能分组
   - 复用原子类减少代码量

2. 构建优化
   - 自动清除未使用的样式
   - 压缩CSS文件
   - 缓存友好的文件组织
