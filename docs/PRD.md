# 端到端加密聊天平台需求文档

## 1. 产品概述
一个基于Java EE的端到端加密即时通讯平台，采用简约设计理念，注重核心通讯功能和安全性。

## 2. 功能模块

### 2.1 用户系统
#### 2.1.1 注册功能
- 用户名（唯一标识）
- 密码（用于平台认证）
- PIN码（用于加密私钥）
- 注册时生成用户密钥对

#### 2.1.2 登录功能
- 用户名/密码登录
- 登录后需要输入PIN码解锁私钥
- 会话保持功能

### 2.2 聊天系统
#### 2.2.1 会话管理
- 通过用户名搜索用户并创建会话
- 首次聊天自动建立加密通道

#### 2.2.2 会话列表
- 按最新消息时间排序
- 显示最后一条消息预览
- 显示未读消息数量及全局汇总
- 显示会话对方用户名
- 基于最后访问时间的未读计数

#### 2.2.3 聊天界面
- 消息按时间正序排列
- 动态加载历史消息
- 支持Markdown基础非段落格式：
  * 斜体
  * 等宽字体
  * 文本高亮
  * 下划线
  * 删除线

## 3. 安全特征

### 3.1 用户认证安全
- 用户密码使用Argon2id算法散列存储
- 密码复杂度要求及校验
- 登录会话7天后自动失效

### 3.2 加密流程
- 所有加解密操作在前端使用WebCrypto API完成
- 服务端仅负责加密消息的转发存储
- 会话密钥通过双方公钥进行密钥协商生成
- 每个会话使用独立的会话密钥

### 3.3 加密算法
- KDF：PBKDF2-SHA-256，用于从PIN生成私钥加密密钥
- 对称加密：AES-256-GCM，用于加密消息和私钥
- 非对称加密：P-256，用于密钥协商
